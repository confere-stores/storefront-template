{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-compre-confie/src/index.js"],"names":["options","compreConfieStoreId","router","window","storefrontApp","addConfirmationBanner","name","params","json","order","orderJson","decodeURIComponent","JSON","parse","e","customer","ecomPassport","getCustomer","transaction","transactions","payer","customerName","getFullName","date","Date","ccParam","amount","total","freight","number","_id","main_email","encodeURIComponent","getFullYear","getMonth","getDate","gender","registry_type","doc_number","birth_date","day","month","year","toString","padStart","navigator","userAgent","includes","items","length","skus","sku","values","getPrice","quantities","quantity","names","productMktSaleID","i","shipping_lines","shippingLine","app","label","toLowerCase","delivery_time","days","to","zip","intermediator","code","fullname","installments","payment_method","credit_card","company","appendBanner","$confirmation","document","getElementById","insertAdjacentHTML","$script","createElement","id","type","src","body","appendChild","clearInterval","tryAppendInterval","setInterval","currentRoute","afterEach","console","error","Error"],"mappings":"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","file":"chunk.ff05745cf248f143557f.js","sourcesContent":["import {\n  price as getPrice,\n  fullName as getFullName\n} from '@ecomplus/utils'\n\nimport ecomPassport from '@ecomplus/passport-client'\n\nexport default (options = {}) => {\n  const { compreConfieStoreId } = options\n  if (compreConfieStoreId) {\n    const router = window.storefrontApp && window.storefrontApp.router\n    if (router) {\n      const addConfirmationBanner = ({ name, params }) => {\n        if (name === 'confirmation' && params.json) {\n          let order\n          const orderJson = decodeURIComponent(params.json)\n          if (orderJson) {\n            try {\n              order = JSON.parse(orderJson)\n            } catch (e) {\n            }\n          }\n\n          if (order) {\n            const customer = ecomPassport.getCustomer()\n            const transaction = order.transactions && order.transactions[0]\n            const payer = transaction && transaction.payer\n            const customerName = getFullName(customer)\n            const date = new Date()\n\n            let ccParam = `orderSellerID=${compreConfieStoreId}` +\n              `&orderTotalSpent=${order.amount.total}` +\n              `&orderDeliveryTax=${(order.amount.freight || 0)}` +\n              `&orderID=${(order.number || order._id)}` +\n              `&consumerEmail=${customer.main_email}` +\n              `&billingEmail=${customer.main_email}` +\n              `&consumerName=${encodeURIComponent(customerName)}` +\n              `&orderDate=${date.getFullYear()}-${(date.getMonth() + 1)}-${date.getDate()}`\n            if (customer.gender === 'm') {\n              ccParam += '&consumerGender=Masculino&billingGender=Masculino'\n            } else if (customer.gender === 'f') {\n              ccParam += '&consumerGender=Feminino&billingGender=Feminino'\n            }\n            if (customer.registry_type === 'p' && customer.doc_number) {\n              ccParam += `&consumerCPF=${customer.doc_number}` +\n                `&billingCPF=${((payer && payer.doc_number) || customer.doc_number)}`\n            }\n            if (customer.birth_date) {\n              const { day, month, year } = customer.birth_date\n              ccParam += `&consumerBirthDate=${day.toString().padStart(2, '0')}` +\n                `/${month.toString().padStart(2, '0')}/${year}`\n            }\n            if (navigator && navigator.userAgent.includes('Mobile')) {\n              ccParam += '&orderPlatform=1'\n            } else {\n              ccParam += '&orderPlatform=0'\n            }\n\n            const { items } = order\n            if (items && items.length) {\n              let skus = items[0].sku\n              let values = getPrice(items[0])\n              let quantities = items[0].quantity\n              let names = encodeURIComponent(items[0].name)\n              let productMktSaleID = '0'\n              for (let i = 1; i < items.length; i++) {\n                skus += `|${items[i].sku}`\n                values += `|${getPrice(items[i])}`\n                quantities += `|${items[i].quantity}`\n                names += `|${encodeURIComponent(items[i].name)}`\n                productMktSaleID += '|0'\n              }\n              ccParam += `&productSKU=${skus}&productValue=${values}&productQuantity=${quantities}` +\n                `&ProductName=${names}&ProductMktSaleID=${productMktSaleID}`\n            }\n\n            if (order.shipping_lines && order.shipping_lines[0]) {\n              const shippingLine = order.shipping_lines[0]\n              if (shippingLine.app && shippingLine.app.label) {\n                ccParam += '&orderDeliveryType='\n                switch (shippingLine.app.label.toLowerCase()) {\n                  case 'pac':\n                    ccParam += '0'\n                    break\n                  case 'sedex':\n                    ccParam += '1'\n                    break\n                  case 'retirar na loja':\n                    ccParam += '3'\n                    break\n                  default:\n                    ccParam += '4'\n                }\n              }\n              if (shippingLine.delivery_time && shippingLine.delivery_time.days) {\n                ccParam += `&orderDeliveryTime=${shippingLine.delivery_time.days}` +\n                  `&productDeliveryTime=${shippingLine.delivery_time.days}`\n              }\n              ccParam += `&consumerZipcode=${shippingLine.to.zip}` +\n                `&billingZipcode=${shippingLine.to.zip}`\n            }\n\n            if (transaction) {\n              if (transaction.app && transaction.app.intermediator && transaction.app.intermediator.code) {\n                ccParam += `&orderPartnerPayment=`\n                switch (transaction.app.intermediator.code.toLowerCase()) {\n                  case 'mercadopago':\n                    ccParam += '1'\n                    break\n                  case 'paypal':\n                    ccParam += '2'\n                    break\n                  case 'pagseguro':\n                    ccParam += '4'\n                    break\n                  case 'pagarme':\n                    ccParam += '7'\n                    break\n                  case 'wirecard':\n                    ccParam += '8'\n                    break\n                  case 'vindi':\n                    ccParam += '12'\n                    break\n                  default:\n                    ccParam += '17'\n                }\n              }\n              ccParam += `&billingName=${encodeURIComponent((payer && payer.fullname) || customerName)}`\n              ccParam += `&orderParcels=${((transaction.installments && transaction.installments.number) || 1)}`\n              ccParam += '&orderPaymentType='\n              switch (transaction.payment_method.code) {\n                case 'credit_card':\n                  ccParam += '1'\n                  break\n                case 'banking_billet':\n                  ccParam += '2'\n                  break\n                case 'debit_card':\n                case 'online_debit':\n                  ccParam += '9'\n                  break\n                case 'account_deposit':\n                  ccParam += '6'\n                  break\n                case 'loyalty_points':\n                  ccParam += '8'\n                  break\n                default:\n                  ccParam += '3'\n              }\n\n              if (transaction.credit_card && transaction.credit_card.company) {\n                ccParam += '&orderCardFlag='\n                switch (transaction.credit_card.company.toLowerCase()) {\n                  case 'visa':\n                    ccParam += 3\n                    break\n                  case 'mastercard':\n                    ccParam += 2\n                    break\n                  case 'american express':\n                  case 'amex':\n                    ccParam += 5\n                    break\n                  case 'elo':\n                    ccParam += 8\n                    break\n                  case 'aura':\n                    ccParam += 7\n                    break\n                  case 'hipercard':\n                    ccParam += 6\n                    break\n                  case 'diners club':\n                    ccParam += 1\n                    break\n                  default:\n                    ccParam += 9\n                }\n              }\n            }\n\n            const appendBanner = () => {\n              const $confirmation = document.getElementById('confirmation')\n              if ($confirmation) {\n                $confirmation.insertAdjacentHTML(\n                  'beforeend',\n                  `<a id=\"bannerEconfy\"></a> <param id=\"TagEConfy\" value=\"${ccParam}\">`\n                )\n                const $script = document.createElement('script')\n                $script.id = 'getData'\n                $script.type = 'text/javascript'\n                $script.src = 'https://banner.compreconfie.com.br/scripts/tagBanner.min.js' +\n                  `?${compreConfieStoreId}&lightbox=true`\n                document.body.appendChild($script)\n                clearInterval(tryAppendInterval)\n              }\n            }\n            const tryAppendInterval = setInterval(appendBanner, 200)\n          }\n        }\n      }\n\n      if (router.currentRoute) {\n        addConfirmationBanner(router.currentRoute)\n      }\n      router.afterEach(addConfirmationBanner)\n    }\n  } else {\n    console.error(new Error('Can\\'t show lightbox without `compreConfieStoreId` option'))\n  }\n}\n"],"sourceRoot":""}