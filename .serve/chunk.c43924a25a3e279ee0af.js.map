{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-compre-confie/src/index.js"],"names":["options","compreConfieStoreId","router","window","storefrontApp","addConfirmationBanner","name","params","json","order","orderJson","decodeURIComponent","JSON","parse","e","customer","ecomPassport","getCustomer","transaction","transactions","payer","customerName","getFullName","date","Date","ccParam","amount","total","freight","number","_id","main_email","encodeURIComponent","getDate","getMonth","getFullYear","getHours","getMinutes","getSeconds","gender","registry_type","doc_number","birth_date","day","month","year","toString","padStart","items","length","skus","sku","values","getPrice","quantities","quantity","names","productMktSaleID","i","shipping_lines","shippingLine","app","label","toLowerCase","delivery_time","days","to","zip","intermediator","fullname","installments","payment_method","code","credit_card","company","appendBanner","$confirmation","document","getElementById","insertAdjacentHTML","$script","createElement","id","type","src","body","appendChild","clearInterval","tryAppendInterval","setInterval","currentRoute","afterEach","console","error","Error"],"mappings":"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","file":"chunk.c43924a25a3e279ee0af.js","sourcesContent":["import {\n  price as getPrice,\n  fullName as getFullName\n} from '@ecomplus/utils'\n\nimport ecomPassport from '@ecomplus/passport-client'\n\nexport default (options = {}) => {\n  const { compreConfieStoreId } = options\n  if (compreConfieStoreId) {\n    const router = window.storefrontApp && window.storefrontApp.router\n    if (router) {\n      const addConfirmationBanner = ({ name, params }) => {\n        if (name === 'confirmation' && params.json) {\n          let order\n          const orderJson = decodeURIComponent(params.json)\n          if (orderJson) {\n            try {\n              order = JSON.parse(orderJson)\n            } catch (e) {\n            }\n          }\n\n          if (order) {\n            const customer = ecomPassport.getCustomer()\n            const transaction = order.transactions && order.transactions[0]\n            const payer = transaction && transaction.payer\n            const customerName = getFullName(customer)\n            const date = new Date()\n\n            let ccParam = `orderSellerID=${compreConfieStoreId}&orderPlatform=ecomplus` +\n              `&orderTotalSpent=${order.amount.total}` +\n              `&orderDeliveryTax=${(order.amount.freight || 0)}` +\n              `&orderID=${(order.number || order._id)}` +\n              `&consumerEmail=${customer.main_email}` +\n              `&billingEmail=${customer.main_email}` +\n              `&consumerName=${encodeURIComponent(customerName)}` +\n              `&orderDate=${date.getDate()}/${(date.getMonth() + 1)}/${date.getFullYear()} | ` +\n                `${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`\n            if (customer.gender === 'm') {\n              ccParam += '&consumerGender=Masculino&billingGender=Masculino'\n            } else if (customer.gender === 'f') {\n              ccParam += '&consumerGender=Feminino&billingGender=Feminino'\n            }\n            if (customer.registry_type === 'p' && customer.doc_number) {\n              ccParam += `&consumerCPF=${customer.doc_number}` +\n                `&billingCPF=${((payer && payer.doc_number) || customer.doc_number)}`\n            }\n            if (customer.birth_date) {\n              const { day, month, year } = customer.birth_date\n              ccParam += `&consumerBirthDate=${day.toString().padStart(2, '0')}` +\n                `/${month.toString().padStart(2, '0')}/${year}`\n            }\n\n            const { items } = order\n            if (items && items.length) {\n              let skus = items[0].sku\n              let values = getPrice(items[0])\n              let quantities = items[0].quantity\n              let names = encodeURIComponent(items[0].name)\n              let productMktSaleID = '0'\n              for (let i = 1; i < items.length; i++) {\n                skus += `|${items[i].sku}`\n                values += `|${getPrice(items[i])}`\n                quantities += `|${items[i].quantity}`\n                names += `|${encodeURIComponent(items[i].name)}`\n                productMktSaleID += '|0'\n              }\n              ccParam += `&productSKU=${skus}&productValue=${values}&productQuantity=${quantities}` +\n                `&ProductName=${names}&ProductMktSaleID=${productMktSaleID}`\n            }\n\n            if (order.shipping_lines && order.shipping_lines[0]) {\n              const shippingLine = order.shipping_lines[0]\n              if (shippingLine.app && shippingLine.app.label) {\n                ccParam += '&orderDeliveryType='\n                switch (shippingLine.app.label.toLowerCase()) {\n                  case 'pac':\n                    ccParam += '0'\n                    break\n                  case 'sedex':\n                    ccParam += '1'\n                    break\n                  case 'retirar na loja':\n                    ccParam += '3'\n                    break\n                  default:\n                    ccParam += '4'\n                }\n              }\n              if (shippingLine.delivery_time && shippingLine.delivery_time.days) {\n                ccParam += `&orderDeliveryTime=${shippingLine.delivery_time.days}` +\n                  `&productDeliveryTime=${shippingLine.delivery_time.days}`\n              }\n              ccParam += `&consumerZipcode=${shippingLine.to.zip}` +\n                `&billingZipcode=${shippingLine.to.zip}`\n            }\n\n            if (transaction) {\n              if (transaction.app && transaction.app.intermediator && transaction.app.intermediator.name) {\n                ccParam += `&orderPartnerPayment=${transaction.app.intermediator.name}`\n              }\n              ccParam += `&billingName=${encodeURIComponent((payer && payer.fullname) || customerName)}`\n              ccParam += `&orderParcels=${((transaction.installments && transaction.installments.number) || 1)}`\n              ccParam += '&orderPaymentType='\n              switch (transaction.payment_method.code) {\n                case 'credit_card':\n                  ccParam += '1'\n                  break\n                case 'banking_billet':\n                  ccParam += '2'\n                  break\n                case 'debit_card':\n                case 'online_debit':\n                  ccParam += '9'\n                  break\n                case 'account_deposit':\n                  ccParam += '6'\n                  break\n                case 'loyalty_points':\n                  ccParam += '8'\n                  break\n                default:\n                  ccParam += '3'\n              }\n\n              if (transaction.credit_card && transaction.credit_card.company) {\n                ccParam += '&orderCardFlag='\n                switch (transaction.credit_card.company.toLowerCase()) {\n                  case 'visa':\n                    ccParam += 3\n                    break\n                  case 'mastercard':\n                    ccParam += 2\n                    break\n                  case 'american express':\n                  case 'amex':\n                    ccParam += 5\n                    break\n                  case 'elo':\n                    ccParam += 8\n                    break\n                  case 'aura':\n                    ccParam += 7\n                    break\n                  case 'hipercard':\n                    ccParam += 6\n                    break\n                  case 'diners club':\n                    ccParam += 1\n                    break\n                  default:\n                    ccParam += 9\n                }\n              }\n            }\n\n            const appendBanner = () => {\n              const $confirmation = document.getElementById('confirmation')\n              if ($confirmation) {\n                $confirmation.insertAdjacentHTML(\n                  'beforeend',\n                  `<a id=\"bannerEconfy\"></a> <param id=\"TagEConfy\" value=\"${ccParam}\">`\n                )\n                const $script = document.createElement('script')\n                $script.id = 'getData'\n                $script.type = 'text/javascript'\n                $script.src = 'https://banner.compreconfie.com.br/scripts/tagBanner.min.js' +\n                  `?${compreConfieStoreId}&lightbox=true`\n                document.body.appendChild($script)\n                clearInterval(tryAppendInterval)\n              }\n            }\n            const tryAppendInterval = setInterval(appendBanner, 200)\n          }\n        }\n      }\n\n      if (router.currentRoute) {\n        addConfirmationBanner(router.currentRoute)\n      }\n      router.afterEach(addConfirmationBanner)\n    }\n  } else {\n    console.error(new Error('Can\\'t show lightbox without `compreConfieStoreId` option'))\n  }\n}\n"],"sourceRoot":""}