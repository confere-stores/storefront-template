{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-ebit/src/index.js"],"names":["options","ebitStoreId","router","window","storefrontApp","countConfirmation","addConfirmationBanner","name","params","ecomPassport","fetchOrder","id","then","order","customer","getCustomer","ebitParam","amount","total","freight","number","_id","main_email","gender","toUpperCase","birth_date","day","month","year","toString","padStart","items","length","skus","sku","values","getPrice","quantities","quantity","names","encodeURIComponent","i","shipping_lines","shippingLine","delivery_time","days","to","zip","transactions","transaction","installments","payment_method","code","credit_card","company","toLowerCase","appendBanner","$confirmation","document","getElementById","insertAdjacentHTML","$script","createElement","type","src","body","appendChild","clearInterval","tryAppendInterval","setInterval","catch","console","error","currentRoute","afterEach","Error"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AACA;AAEe,gEAACA,OAAO,GAAG,EAAX,KAAkB;AAC/B,QAAM;AAAEC;AAAF,MAAkBD,OAAxB;;AACA,MAAIC,WAAJ,EAAiB;AACf,UAAMC,MAAM,GAAGC,MAAM,CAACC,aAAP,IAAwBD,MAAM,CAACC,aAAP,CAAqBF,MAA5D;;AACA,QAAIA,MAAJ,EAAY;AACV,UAAIG,iBAAiB,GAAG,CAAxB;;AACA,YAAMC,qBAAqB,GAAG,CAAC;AAAEC,YAAF;AAAQC;AAAR,OAAD,KAAsB;AAClD,YAAID,IAAI,KAAK,cAAT,IAA2BF,iBAAiB,KAAK,CAArD,EAAwD;AACtDA,2BAAiB;AACjBI,2EAAY,CAACC,UAAb,CAAwBF,MAAM,CAACG,EAA/B,EACGC,IADH,CACQC,KAAK,IAAI;AACb,kBAAMC,QAAQ,GAAGL,iEAAY,CAACM,WAAb,EAAjB;AACA,gBAAIC,SAAS,GAAI,WAAUf,WAAY,gCAAvB,GACb,eAAcY,KAAK,CAACI,MAAN,CAAaC,KAAM,EADpB,GAEb,gBAAgBL,KAAK,CAACI,MAAN,CAAaE,OAAb,IAAwB,CAAG,EAF9B,GAGb,kBAAkBN,KAAK,CAACO,MAAN,IAAgBP,KAAK,CAACQ,GAAK,EAHhC,GAIb,UAASP,QAAQ,CAACQ,UAAW,EAJhC;;AAMA,gBAAIR,QAAQ,CAACS,MAAb,EAAqB;AACnBP,uBAAS,IAAK,WAAUF,QAAQ,CAACS,MAAT,CAAgBC,WAAhB,EAA8B,EAAtD;AACD;;AACD,gBAAIV,QAAQ,CAACW,UAAb,EAAyB;AACvB,oBAAM;AAAEC,mBAAF;AAAOC,qBAAP;AAAcC;AAAd,kBAAuBd,QAAQ,CAACW,UAAtC;AACAT,uBAAS,IAAK,aAAYU,GAAG,CAACG,QAAJ,GAAeC,QAAf,CAAwB,CAAxB,EAA2B,GAA3B,CAAgC,EAA7C,GACV,IAAGH,KAAK,CAACE,QAAN,GAAiBC,QAAjB,CAA0B,CAA1B,EAA6B,GAA7B,CAAkC,IAAGF,IAAK,EADhD;AAED;;AAED,kBAAM;AAAEG;AAAF,gBAAYlB,KAAlB;;AACA,gBAAIkB,KAAK,IAAIA,KAAK,CAACC,MAAnB,EAA2B;AACzB,kBAAIC,IAAI,GAAGF,KAAK,CAAC,CAAD,CAAL,CAASG,GAApB;AACA,kBAAIC,MAAM,GAAGC,6DAAQ,CAACL,KAAK,CAAC,CAAD,CAAN,CAArB;AACA,kBAAIM,UAAU,GAAGN,KAAK,CAAC,CAAD,CAAL,CAASO,QAA1B;AACA,kBAAIC,KAAK,GAAGC,kBAAkB,CAACT,KAAK,CAAC,CAAD,CAAL,CAASxB,IAAV,CAA9B;;AACA,mBAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,KAAK,CAACC,MAA1B,EAAkCS,CAAC,EAAnC,EAAuC;AACrCR,oBAAI,IAAK,IAAGF,KAAK,CAACU,CAAD,CAAL,CAASP,GAAI,EAAzB;AACAC,sBAAM,IAAK,IAAGC,6DAAQ,CAACL,KAAK,CAACU,CAAD,CAAN,CAAW,EAAjC;AACAJ,0BAAU,IAAK,IAAGN,KAAK,CAACU,CAAD,CAAL,CAASH,QAAS,EAApC;AACAC,qBAAK,IAAK,IAAGC,kBAAkB,CAACT,KAAK,CAACU,CAAD,CAAL,CAASlC,IAAV,CAAgB,EAA/C;AACD;;AACDS,uBAAS,IAAK,QAAOiB,IAAK,UAASE,MAAO,aAAYE,UAAW,gBAAeE,KAAM,EAAtF;AACD;;AAED,gBAAI1B,KAAK,CAAC6B,cAAN,IAAwB7B,KAAK,CAAC6B,cAAN,CAAqB,CAArB,CAA5B,EAAqD;AACnD,oBAAMC,YAAY,GAAG9B,KAAK,CAAC6B,cAAN,CAAqB,CAArB,CAArB;AACA1B,uBAAS,IAAK,iBAAiB2B,YAAY,CAACC,aAAb,CAA2BC,IAA3B,IAAmC,CAAG,EAAxD,GACV,YAAWF,YAAY,CAACG,EAAb,CAAgBC,GAAI,EADlC;AAED;;AAED,gBAAIlC,KAAK,CAACmC,YAAN,IAAsBnC,KAAK,CAACmC,YAAN,CAAmB,CAAnB,CAA1B,EAAiD;AAC/C,oBAAMC,WAAW,GAAGpC,KAAK,CAACmC,YAAN,CAAmB,CAAnB,CAApB;AACAhC,uBAAS,IAAK,YAAaiC,WAAW,CAACC,YAAZ,IAA4BD,WAAW,CAACC,YAAZ,CAAyB9B,MAAtD,IAAiE,CAAG,EAA9F;AACAJ,uBAAS,IAAI,eAAb;;AACA,sBAAQiC,WAAW,CAACE,cAAZ,CAA2BC,IAAnC;AACE,qBAAK,aAAL;AACEpC,2BAAS,IAAI,IAAb;AACA;;AACF,qBAAK,gBAAL;AACEA,2BAAS,IAAI,IAAb;AACA;;AACF,qBAAK,YAAL;AACA,qBAAK,cAAL;AACA,qBAAK,iBAAL;AACEA,2BAAS,IAAI,IAAb;AACA;;AACF,qBAAK,gBAAL;AACEA,2BAAS,IAAI,IAAb;AACA;;AACF;AACEA,2BAAS,IAAI,IAAb;AAhBJ;;AAmBA,kBAAIiC,WAAW,CAACI,WAAZ,IAA2BJ,WAAW,CAACI,WAAZ,CAAwBC,OAAvD,EAAgE;AAC9DtC,yBAAS,IAAI,YAAb;;AACA,wBAAQiC,WAAW,CAACI,WAAZ,CAAwBC,OAAxB,CAAgCC,WAAhC,EAAR;AACE,uBAAK,MAAL;AACEvC,6BAAS,IAAI,CAAb;AACA;;AACF,uBAAK,YAAL;AACEA,6BAAS,IAAI,CAAb;AACA;;AACF,uBAAK,kBAAL;AACA,uBAAK,MAAL;AACEA,6BAAS,IAAI,CAAb;AACA;;AACF,uBAAK,KAAL;AACEA,6BAAS,IAAI,CAAb;AACA;;AACF,uBAAK,MAAL;AACEA,6BAAS,IAAI,CAAb;AACA;;AACF,uBAAK,WAAL;AACEA,6BAAS,IAAI,CAAb;AACA;;AACF,uBAAK,aAAL;AACEA,6BAAS,IAAI,CAAb;AACA;;AACF;AACEA,6BAAS,IAAI,CAAb;AAxBJ;AA0BD;AACF;;AAED,kBAAMwC,YAAY,GAAG,MAAM;AACzB,oBAAMC,aAAa,GAAGC,QAAQ,CAACC,cAAT,CAAwB,cAAxB,CAAtB;;AACA,kBAAIF,aAAJ,EAAmB;AACjBA,6BAAa,CAACG,kBAAd,CACE,WADF,EAEG,sCAAqC5C,SAAU,mCAFlD;AAIA,sBAAM6C,OAAO,GAAGH,QAAQ,CAACI,aAAT,CAAuB,QAAvB,CAAhB;AACAD,uBAAO,CAAClD,EAAR,GAAa,SAAb;AACAkD,uBAAO,CAACE,IAAR,GAAe,iBAAf;AACAF,uBAAO,CAACG,GAAR,GAAc,4DACX,IAAG/D,WAAY,gBADlB;AAEAyD,wBAAQ,CAACO,IAAT,CAAcC,WAAd,CAA0BL,OAA1B;AACAM,6BAAa,CAACC,iBAAD,CAAb;AACD;AACF,aAfD;;AAgBA,kBAAMA,iBAAiB,GAAGC,WAAW,CAACb,YAAD,EAAe,GAAf,CAArC;AACD,WA9GH,EA+GGc,KA/GH,CA+GSC,OAAO,CAACC,KA/GjB;AAgHD;AACF,OApHD;;AAsHA,UAAItE,MAAM,CAACuE,YAAX,EAAyB;AACvBnE,6BAAqB,CAACJ,MAAM,CAACuE,YAAR,CAArB;AACD;;AACDvE,YAAM,CAACwE,SAAP,CAAiBpE,qBAAjB;AACD;AACF,GA/HD,MA+HO;AACLiE,WAAO,CAACC,KAAR,CAAc,IAAIG,KAAJ,CAAU,mDAAV,CAAd;AACD;AACF,CApID,E","file":"chunk.3b7c5308b0a6f6c0894d.js","sourcesContent":["import { price as getPrice } from '@ecomplus/utils'\nimport ecomPassport from '@ecomplus/passport-client'\n\nexport default (options = {}) => {\n  const { ebitStoreId } = options\n  if (ebitStoreId) {\n    const router = window.storefrontApp && window.storefrontApp.router\n    if (router) {\n      let countConfirmation = 0\n      const addConfirmationBanner = ({ name, params }) => {\n        if (name === 'confirmation' && countConfirmation === 0) {\n          countConfirmation++\n          ecomPassport.fetchOrder(params.id)\n            .then(order => {\n              const customer = ecomPassport.getCustomer()\n              let ebitParam = `storeId=${ebitStoreId}&mktSaleId=0&platform=ecomplus` +\n                `&totalSpent=${order.amount.total}` +\n                `&deliveryTax=${(order.amount.freight || 0)}` +\n                `&transactionId=${(order.number || order._id)}` +\n                `&email=${customer.main_email}`\n\n              if (customer.gender) {\n                ebitParam += `&gender=${customer.gender.toUpperCase()}`\n              }\n              if (customer.birth_date) {\n                const { day, month, year } = customer.birth_date\n                ebitParam += `&birthday=${day.toString().padStart(2, '0')}` +\n                  `-${month.toString().padStart(2, '0')}-${year}`\n              }\n\n              const { items } = order\n              if (items && items.length) {\n                let skus = items[0].sku\n                let values = getPrice(items[0])\n                let quantities = items[0].quantity\n                let names = encodeURIComponent(items[0].name)\n                for (let i = 1; i < items.length; i++) {\n                  skus += `|${items[i].sku}`\n                  values += `|${getPrice(items[i])}`\n                  quantities += `|${items[i].quantity}`\n                  names += `|${encodeURIComponent(items[i].name)}`\n                }\n                ebitParam += `&sku=${skus}&value=${values}&quantity=${quantities}&productName=${names}`\n              }\n\n              if (order.shipping_lines && order.shipping_lines[0]) {\n                const shippingLine = order.shipping_lines[0]\n                ebitParam += `&deliveryTime=${(shippingLine.delivery_time.days || 0)}` +\n                  `&zipCode=${shippingLine.to.zip}`\n              }\n\n              if (order.transactions && order.transactions[0]) {\n                const transaction = order.transactions[0]\n                ebitParam += `&parcels=${((transaction.installments && transaction.installments.number) || 1)}`\n                ebitParam += '&paymentType='\n                switch (transaction.payment_method.code) {\n                  case 'credit_card':\n                    ebitParam += '05'\n                    break\n                  case 'banking_billet':\n                    ebitParam += '08'\n                    break\n                  case 'debit_card':\n                  case 'online_debit':\n                  case 'account_deposit':\n                    ebitParam += '28'\n                    break\n                  case 'loyalty_points':\n                    ebitParam += '24'\n                    break\n                  default:\n                    ebitParam += '14'\n                }\n\n                if (transaction.credit_card && transaction.credit_card.company) {\n                  ebitParam += '&cardFlag='\n                  switch (transaction.credit_card.company.toLowerCase()) {\n                    case 'visa':\n                      ebitParam += 6\n                      break\n                    case 'mastercard':\n                      ebitParam += 5\n                      break\n                    case 'american express':\n                    case 'amex':\n                      ebitParam += 1\n                      break\n                    case 'elo':\n                      ebitParam += 8\n                      break\n                    case 'aura':\n                      ebitParam += 2\n                      break\n                    case 'hipercard':\n                      ebitParam += 4\n                      break\n                    case 'diners club':\n                      ebitParam += 3\n                      break\n                    default:\n                      ebitParam += 7\n                  }\n                }\n              }\n\n              const appendBanner = () => {\n                const $confirmation = document.getElementById('confirmation')\n                if ($confirmation) {\n                  $confirmation.insertAdjacentHTML(\n                    'beforeend',\n                    `<div> <param id=\"ebitParam\" value=\"${ebitParam}\"> <a id=\"bannerEbit\"></a> </div>`\n                  )\n                  const $script = document.createElement('script')\n                  $script.id = 'getSelo'\n                  $script.type = 'text/javascript'\n                  $script.src = 'https://imgs.ebit.com.br/ebitBR/selo-ebit/js/getSelo.js' +\n                    `?${ebitStoreId}&lightbox=true`\n                  document.body.appendChild($script)\n                  clearInterval(tryAppendInterval)\n                }\n              }\n              const tryAppendInterval = setInterval(appendBanner, 200)\n            })\n            .catch(console.error)\n        }\n      }\n\n      if (router.currentRoute) {\n        addConfirmationBanner(router.currentRoute)\n      }\n      router.afterEach(addConfirmationBanner)\n    }\n  } else {\n    console.error(new Error('Can\\'t show lightbox without `ebitStoreId` option'))\n  }\n}\n"],"sourceRoot":""}