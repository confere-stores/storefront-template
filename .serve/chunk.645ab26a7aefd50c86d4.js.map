{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-analytics/src/index.js","webpack:///./node_modules/@ecomplus/widget-analytics/src/lib/watch-app-routes.js","webpack:///./node_modules/@ecomplus/widget-analytics/src/lib/watch-shopping-cart.js","webpack:///./node_modules/@ecomplus/widget-tag-manager/src/lib/common.js","webpack:///./node_modules/@ecomplus/widget-tag-manager/src/lib/watch-app-routes.js","webpack:///./node_modules/@ecomplus/widget-tag-manager/src/lib/watch-shopping-cart.js"],"names":["options","gaTrackingId","gtag","window","watchAppRoutes","watchShoppingCart","location","$","emitPageView","setTimeout","page_title","document","title","page_path","hash","split","send_to","push","event","ecommerce","data","checkout","items","products","checkout_step","startsWith","purchase","actionField","transaction_id","id","affiliation","attr","value","Number","revenue","currency","currencyCode","tax","shipping","slice","$ecomConfig","get","getProductData","item","productData","name","sku","price","toFixed","quantity","dataLayer","router","storefrontApp","isCartSent","isCheckoutSent","isPurchaseSent","getCartProductsList","ecomCart","Array","isArray","forEach","emitCheckoutOption","checkout_option","emitCheckout","step","option","emitPurchase","orderId","orderJson","amount","total","subtotal","freight","undefined","order","JSON","parse","e","field","i","extra_discount","discount_coupon","coupon","emitPurchaseTimer","addRouteToData","params","clearTimeout","json","decodeURIComponent","currentRoute","afterEach","productsBySku","emitAddToCart","add","emitRemoveFromCart","remove","Object","assign","on"],"mappings":"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","file":"chunk.645ab26a7aefd50c86d4.js","sourcesContent":["import watchAppRoutes from './lib/watch-app-routes'\nimport watchShoppingCart from './lib/watch-shopping-cart'\n\nexport default (options = {}) => {\n  const { gaTrackingId } = options\n  const { gtag } = window\n\n  if (typeof gtag === 'function') {\n    watchAppRoutes(gtag, gaTrackingId)\n    watchShoppingCart(gtag, gaTrackingId)\n  }\n}\n","import watchAppRoutes from '@ecomplus/widget-tag-manager/src/lib/watch-app-routes'\n\nconst { location, $ } = window\n\nexport default (gtag, gaTrackingId) => {\n  const emitPageView = () => setTimeout(() => {\n    gtag('event', 'page_view', {\n      page_title: document.title || 'Checkout',\n      page_path: `/${location.hash.split('/')[1]}`,\n      send_to: gaTrackingId\n    })\n  }, 300)\n\n  watchAppRoutes({\n    push: ({ event, ecommerce }) => {\n      let data\n      switch (event) {\n        case 'eec.checkout':\n        case 'eec.checkout_option':\n          data = ecommerce && ecommerce.checkout\n          if (data) {\n            gtag('event', 'begin_checkout', {\n              items: data.products\n            })\n          }\n          gtag('event', 'set_checkout_option', {\n            checkout_step: location.hash.startsWith('#/cart') ? 1 : 2\n          })\n          break\n\n        case 'eec.purchase':\n          emitPageView()\n          data = ecommerce && ecommerce.purchase\n          if (data && data.actionField) {\n            gtag('event', 'purchase', {\n              transaction_id: data.actionField.id,\n              affiliation: $('meta[name=\"author\"]').attr('content') || 'Shop',\n              value: Number(data.actionField.revenue),\n              currency: ecommerce.currencyCode,\n              tax: data.actionField.tax ? Number(data.actionField.tax) : 0,\n              shipping: data.actionField.shipping ? Number(data.actionField.shipping) : 0,\n              items: data.products\n            })\n          }\n          break\n\n        default:\n          emitPageView()\n      }\n    }\n  })\n}\n","import watchShoppingCart from '@ecomplus/widget-tag-manager/src/lib/watch-shopping-cart'\n\nexport default gtag => {\n  watchShoppingCart({\n    push: ({ event, ecommerce }) => {\n      if (ecommerce && (event === 'eec.add' || event === 'eec.remove')) {\n        const data = ecommerce[event.slice(4)]\n        if (data && data.products) {\n          gtag('event', event === 'eec.add' ? 'add_to_cart' : 'remove_from_cart', {\n            items: data.products\n          })\n        }\n      }\n    }\n  })\n}\n","import { $ecomConfig, name, price } from '@ecomplus/utils'\n\nexport const currencyCode = $ecomConfig.get('currency') || 'BRL'\n\nexport const getProductData = item => {\n  const productData = {\n    name: name(item),\n    id: item.sku,\n    price: price(item).toFixed(2)\n  }\n  if (item.quantity) {\n    productData.quantity = item.quantity\n  }\n  return productData\n}\n","import ecomCart from '@ecomplus/shopping-cart'\nimport { currencyCode, getProductData } from './common'\n\nexport default dataLayer => {\n  const router = window.storefrontApp && window.storefrontApp.router\n  if (router) {\n    let isCartSent, isCheckoutSent, isPurchaseSent\n    const getCartProductsList = () => {\n      const products = []\n      if (ecomCart.data && Array.isArray(ecomCart.data.items)) {\n        ecomCart.data.items.forEach(item => {\n          products.push(getProductData(item))\n        })\n      }\n      return products\n    }\n\n    const emitCheckoutOption = actionField => {\n      dataLayer.push({\n        event: 'eec.checkout_option',\n        ecommerce: {\n          currencyCode,\n          checkout_option: { actionField }\n        }\n      })\n    }\n\n    const emitCheckout = (step, option) => {\n      const actionField = { step, option }\n      if (step <= 1 || !isCartSent) {\n        dataLayer.push({\n          event: 'eec.checkout',\n          ecommerce: {\n            currencyCode,\n            checkout: {\n              actionField,\n              products: getCartProductsList()\n            }\n          }\n        })\n        dataLayer.push({ event: 'checkout' })\n        isCartSent = true\n      } else if (!isCheckoutSent) {\n        emitCheckoutOption(actionField)\n        dataLayer.push({ event: 'checkoutOption' })\n        isCheckoutSent = true\n      }\n    }\n\n    const emitPurchase = (orderId, orderJson) => {\n      if (!isPurchaseSent) {\n        const { amount } = window.storefrontApp\n        const actionField = {\n          id: orderId,\n          revenue: (\n            (amount && amount.total) ||\n            (ecomCart.data && ecomCart.data.subtotal) ||\n            0\n          ).toFixed(2)\n        }\n        if (amount) {\n          if (amount.freight !== undefined) {\n            actionField.shipping = amount.freight.toFixed(2)\n          }\n          if (amount.tax !== undefined) {\n            actionField.tax = amount.tax.toFixed(2)\n          }\n        }\n\n        let order\n        if (orderJson) {\n          try {\n            order = JSON.parse(orderJson)\n          } catch (e) {\n          }\n        }\n        if (order) {\n          ;['payment_method_label', 'shipping_method_label'].forEach((field, i) => {\n            if (order[field]) {\n              emitCheckoutOption({\n                step: 3 + i,\n                option: order[field]\n              })\n            }\n          })\n          if (order.extra_discount && order.extra_discount.discount_coupon) {\n            actionField.coupon = order.extra_discount.discount_coupon\n          }\n        }\n\n        dataLayer.push({\n          event: 'eec.purchase',\n          ecommerce: {\n            currencyCode,\n            purchase: {\n              actionField,\n              products: getCartProductsList()\n            }\n          }\n        })\n        isPurchaseSent = true\n      }\n    }\n\n    let emitPurchaseTimer\n    const addRouteToData = ({ name, params }) => {\n      switch (name) {\n        case 'cart':\n          emitCheckout(1, 'Review Cart')\n          break\n        case 'checkout':\n          emitCheckout(2, 'Confirm Purchase')\n          break\n        case 'confirmation':\n          clearTimeout(emitPurchaseTimer)\n          if (params.json) {\n            emitPurchase(params.id, decodeURIComponent(params.json))\n          } else {\n            emitPurchaseTimer = setTimeout(() => {\n              emitPurchase(params.id)\n            }, 1500)\n          }\n          break\n      }\n    }\n\n    if (router.currentRoute) {\n      addRouteToData(router.currentRoute)\n    }\n    router.afterEach(addRouteToData)\n  }\n}\n","import ecomCart from '@ecomplus/shopping-cart'\nimport { currencyCode, getProductData } from './common'\n\nexport default dataLayer => {\n  const productsBySku = {}\n\n  const emitAddToCart = item => {\n    const productData = getProductData(item)\n    dataLayer.push({\n      event: 'eec.add',\n      ecommerce: {\n        currencyCode,\n        add: {\n          products: [productData]\n        }\n      }\n    })\n    dataLayer.push({ event: 'addToCart' })\n    productsBySku[item.sku] = productData\n  }\n\n  const emitRemoveFromCart = item => {\n    const productData = productsBySku[item.sku]\n    dataLayer.push({\n      event: 'eec.remove',\n      ecommerce: {\n        currencyCode,\n        remove: {\n          products: [\n            (productData ? Object.assign({}, productData) : getProductData(item))\n          ]\n        }\n      }\n    })\n    dataLayer.push({ event: 'removeFromCart' })\n    delete productsBySku[item.sku]\n  }\n\n  ecomCart.on('addItem', ({ item }) => emitAddToCart(item))\n\n  ecomCart.on('increaseItemQnt', ({ item }) => {\n    const productData = productsBySku[item.sku]\n    if (!productData) {\n      emitAddToCart(item)\n    } else {\n      const quantity = item.quantity - productData.quantity\n      if (quantity > 0) {\n        emitAddToCart({ ...item, quantity })\n      } else {\n        emitRemoveFromCart({\n          ...item,\n          quantity: -quantity\n        })\n      }\n    }\n  })\n\n  ecomCart.on('removeItem', ({ item }) => emitRemoveFromCart(item))\n\n  ecomCart.on('clear', () => {\n    for (const sku in productsBySku) {\n      if (productsBySku[sku]) {\n        emitRemoveFromCart(productsBySku[sku])\n      }\n    }\n  })\n}\n"],"sourceRoot":""}