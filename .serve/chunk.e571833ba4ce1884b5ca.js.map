{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-gmc-ratings/src/index.js","webpack:///./node_modules/core-js/internals/is-array-iterator-method.js","webpack:///./node_modules/core-js/internals/iterate.js","webpack:///./node_modules/core-js/internals/iterator-close.js","webpack:///./node_modules/core-js/internals/perform.js","webpack:///./node_modules/core-js/modules/es.promise.all-settled.js"],"names":["options","gmcMerchantId","dialogPosition","router","window","storefrontApp","addConfirmationDialog","name","params","json","addDays","days","date","Date","now","setDate","getDate","order","customerEmail","deliveryCountry","deliveryDate","orderJson","decodeURIComponent","JSON","parse","e","buyers","main_email","shippingLine","shipping_lines","delivery_time","posting_deadline","working_days","ecomPassport","getCustomer","$ecomConfig","get","promises","gtins","optInConfig","merchant_id","order_id","number","id","email","delivery_country","estimated_delivery_date","getFullYear","getMonth","toString","padStart","opt_in_style","items","i","length","push","store","url","product_id","then","data","gtin","forEach","gtinCode","includes","catch","console","error","Promise","allSettled","products","map","gapi","load","surveyoptin","render","currentRoute","afterEach","Error"],"mappings":"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","file":"chunk.e571833ba4ce1884b5ca.js","sourcesContent":["import { $ecomConfig } from '@ecomplus/utils'\nimport { store } from '@ecomplus/client'\nimport ecomPassport from '@ecomplus/passport-client'\n\nexport default (options = {}) => {\n  const { gmcMerchantId, dialogPosition } = options\n  if (gmcMerchantId) {\n    const router = window.storefrontApp && window.storefrontApp.router\n    if (router) {\n      const addConfirmationDialog = ({ name, params }) => {\n        if (name === 'confirmation' && params.json) {\n          const addDays = days => {\n            const date = new Date(Date.now())\n            date.setDate(date.getDate() + days)\n            return date\n          }\n\n          let order, customerEmail, deliveryCountry, deliveryDate\n          const orderJson = decodeURIComponent(params.json)\n          if (orderJson) {\n            try {\n              order = JSON.parse(orderJson)\n            } catch (e) {\n            }\n          }\n\n          if (order) {\n            const { buyers } = order\n            if (buyers && buyers[0]) {\n              customerEmail = buyers[0].main_email\n            }\n            const shippingLine = order.shipping_lines && order.shipping_lines[0]\n            if (shippingLine && shippingLine.delivery_time) {\n              let days = shippingLine.delivery_time.days\n              if (shippingLine.posting_deadline) {\n                days += shippingLine.delivery_time.days\n              }\n              if (shippingLine.delivery_time.working_days) {\n                days *= 1.25\n              }\n              deliveryDate = addDays(days + 3)\n            }\n          }\n\n          if (!customerEmail) {\n            customerEmail = ecomPassport.getCustomer().main_email\n          }\n          if (!deliveryCountry) {\n            deliveryCountry = $ecomConfig.get('country_code')\n          }\n          if (!deliveryDate) {\n            deliveryDate = addDays(14)\n          }\n\n          const promises = []\n          const gtins = []\n          const optInConfig = {\n            merchant_id: gmcMerchantId,\n            order_id: params.number || params.id,\n            email: customerEmail,\n            delivery_country: deliveryCountry,\n            estimated_delivery_date: deliveryDate.getFullYear() +\n              `-${(deliveryDate.getMonth() + 1).toString().padStart(2, '0')}-` +\n              deliveryDate.getDate().toString().padStart(2, '0'),\n            opt_in_style: dialogPosition || 'CENTER_DIALOG'\n          }\n\n          if (order && order.items) {\n            for (let i = 0; i < order.items.length && i <= 4; i++) {\n              promises.push(\n                store({ url: `/products/${order.items[i].product_id}.json` })\n                  .then(({ data }) => {\n                    if (data.gtin) {\n                      data.gtin.forEach(gtinCode => {\n                        if (!gtins.includes(gtinCode)) {\n                          gtins.push(gtinCode)\n                        }\n                      })\n                    }\n                  })\n                  .catch(console.error)\n              )\n            }\n          }\n\n          Promise.allSettled(promises).then(() => {\n            if (gtins.length) {\n              optInConfig.products = gtins.map(gtin => ({ gtin }))\n            }\n            window.gapi.load('surveyoptin', function () {\n              window.gapi.surveyoptin.render(optInConfig)\n            })\n          })\n        }\n      }\n\n      if (router.currentRoute) {\n        addConfirmationDialog(router.currentRoute)\n      }\n      router.afterEach(addConfirmationDialog)\n    }\n  } else {\n    console.error(new Error('Can\\'t show opt-in dialog without `gmcMerchantId` option'))\n  }\n}\n","var wellKnownSymbol = require('../internals/well-known-symbol');\nvar Iterators = require('../internals/iterators');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar ArrayPrototype = Array.prototype;\n\n// check on default Array iterator\nmodule.exports = function (it) {\n  return it !== undefined && (Iterators.Array === it || ArrayPrototype[ITERATOR] === it);\n};\n","var global = require('../internals/global');\nvar bind = require('../internals/function-bind-context');\nvar call = require('../internals/function-call');\nvar anObject = require('../internals/an-object');\nvar tryToString = require('../internals/try-to-string');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar getIterator = require('../internals/get-iterator');\nvar getIteratorMethod = require('../internals/get-iterator-method');\nvar iteratorClose = require('../internals/iterator-close');\n\nvar TypeError = global.TypeError;\n\nvar Result = function (stopped, result) {\n  this.stopped = stopped;\n  this.result = result;\n};\n\nvar ResultPrototype = Result.prototype;\n\nmodule.exports = function (iterable, unboundFunction, options) {\n  var that = options && options.that;\n  var AS_ENTRIES = !!(options && options.AS_ENTRIES);\n  var IS_ITERATOR = !!(options && options.IS_ITERATOR);\n  var INTERRUPTED = !!(options && options.INTERRUPTED);\n  var fn = bind(unboundFunction, that);\n  var iterator, iterFn, index, length, result, next, step;\n\n  var stop = function (condition) {\n    if (iterator) iteratorClose(iterator, 'normal', condition);\n    return new Result(true, condition);\n  };\n\n  var callFn = function (value) {\n    if (AS_ENTRIES) {\n      anObject(value);\n      return INTERRUPTED ? fn(value[0], value[1], stop) : fn(value[0], value[1]);\n    } return INTERRUPTED ? fn(value, stop) : fn(value);\n  };\n\n  if (IS_ITERATOR) {\n    iterator = iterable;\n  } else {\n    iterFn = getIteratorMethod(iterable);\n    if (!iterFn) throw TypeError(tryToString(iterable) + ' is not iterable');\n    // optimisation for array iterators\n    if (isArrayIteratorMethod(iterFn)) {\n      for (index = 0, length = lengthOfArrayLike(iterable); length > index; index++) {\n        result = callFn(iterable[index]);\n        if (result && isPrototypeOf(ResultPrototype, result)) return result;\n      } return new Result(false);\n    }\n    iterator = getIterator(iterable, iterFn);\n  }\n\n  next = iterator.next;\n  while (!(step = call(next, iterator)).done) {\n    try {\n      result = callFn(step.value);\n    } catch (error) {\n      iteratorClose(iterator, 'throw', error);\n    }\n    if (typeof result == 'object' && result && isPrototypeOf(ResultPrototype, result)) return result;\n  } return new Result(false);\n};\n","var call = require('../internals/function-call');\nvar anObject = require('../internals/an-object');\nvar getMethod = require('../internals/get-method');\n\nmodule.exports = function (iterator, kind, value) {\n  var innerResult, innerError;\n  anObject(iterator);\n  try {\n    innerResult = getMethod(iterator, 'return');\n    if (!innerResult) {\n      if (kind === 'throw') throw value;\n      return value;\n    }\n    innerResult = call(innerResult, iterator);\n  } catch (error) {\n    innerError = true;\n    innerResult = error;\n  }\n  if (kind === 'throw') throw value;\n  if (innerError) throw innerResult;\n  anObject(innerResult);\n  return value;\n};\n","module.exports = function (exec) {\n  try {\n    return { error: false, value: exec() };\n  } catch (error) {\n    return { error: true, value: error };\n  }\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar call = require('../internals/function-call');\nvar aCallable = require('../internals/a-callable');\nvar newPromiseCapabilityModule = require('../internals/new-promise-capability');\nvar perform = require('../internals/perform');\nvar iterate = require('../internals/iterate');\n\n// `Promise.allSettled` method\n// https://tc39.es/ecma262/#sec-promise.allsettled\n$({ target: 'Promise', stat: true }, {\n  allSettled: function allSettled(iterable) {\n    var C = this;\n    var capability = newPromiseCapabilityModule.f(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var promiseResolve = aCallable(C.resolve);\n      var values = [];\n      var counter = 0;\n      var remaining = 1;\n      iterate(iterable, function (promise) {\n        var index = counter++;\n        var alreadyCalled = false;\n        remaining++;\n        call(promiseResolve, C, promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = { status: 'fulfilled', value: value };\n          --remaining || resolve(values);\n        }, function (error) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = { status: 'rejected', reason: error };\n          --remaining || resolve(values);\n        });\n      });\n      --remaining || resolve(values);\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  }\n});\n"],"sourceRoot":""}