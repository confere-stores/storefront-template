{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/index.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/common.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/parse-context.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/watch-app-routes.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/watch-shopping-cart.js"],"names":["options","window","fbq","track","evName","data","isCustomEv","debug","console","log","parseContext","watchAppRoutes","watchShoppingCart","currency","$ecomConfig","get","getProductData","body","content_ids","sku","content_name","name","value","price","content_type","categories","length","content_category","category_tree","context","storefront","resource","router","storefrontApp","isCartSent","isCheckoutSent","isPurchaseSent","getPurchaseData","amount","total","ecomCart","subtotal","contents","Array","isArray","items","forEach","quantity","push","id","emitCheckout","step","option","purchaseData","customData","checkout_step","checkout_option","emitPurchase","orderId","disablePurchase","order_id","addRouteToData","params","currentRoute","afterEach","on","item"],"mappings":"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","file":"chunk.7e81864bc291e38d30b3.js","sourcesContent":["import parseContext from './lib/parse-context'\nimport watchAppRoutes from './lib/watch-app-routes'\nimport watchShoppingCart from './lib/watch-shopping-cart'\n\nexport default (options = {}) => {\n  if (typeof window.fbq === 'function') {\n    const track = (evName, data = {}, isCustomEv = false) => {\n      if (options.debug) {\n        console.log('fbq', evName, data)\n      }\n      window.fbq(isCustomEv ? 'trackCustom' : 'track', evName, data)\n    }\n\n    parseContext(track)\n    watchAppRoutes(track, options)\n    watchShoppingCart(track)\n  }\n}\n","import { $ecomConfig, price } from '@ecomplus/utils'\n\nexport const currency = $ecomConfig.get('currency') || 'BRL'\n\nexport const getProductData = body => {\n  const data = {\n    currency,\n    content_ids: [body.sku],\n    content_name: body.name,\n    value: price(body),\n    content_type: 'product'\n  }\n  if (body.categories && body.categories.length) {\n    data.content_category = body.category_tree || body.categories[0].name\n  }\n  return data\n}\n","import { getProductData } from './common'\n\nexport default fbq => {\n  const context = window.storefront && window.storefront.context\n  if (context && context.resource === 'products') {\n    fbq('ViewContent', getProductData(context.body))\n  }\n}\n","import ecomCart from '@ecomplus/shopping-cart'\nimport { currency } from './common'\n\nexport default (fbq, options) => {\n  const router = window.storefrontApp && window.storefrontApp.router\n  if (router) {\n    let isCartSent, isCheckoutSent, isPurchaseSent\n\n    const getPurchaseData = () => {\n      const { amount } = window.storefrontApp\n      const data = {\n        value: (\n          (amount && amount.total) ||\n          (ecomCart.data && ecomCart.data.subtotal) ||\n          0\n        ),\n        currency,\n        contents: [],\n        content_type: 'product'\n      }\n      if (ecomCart.data && Array.isArray(ecomCart.data.items)) {\n        ecomCart.data.items.forEach(({ sku, quantity }) => {\n          data.contents.push({ id: sku, quantity })\n        })\n      }\n      return data\n    }\n\n    const emitCheckout = (step, option) => {\n      const purchaseData = getPurchaseData()\n      const customData = {\n        ...purchaseData,\n        checkout_step: step,\n        checkout_option: option\n      }\n      if (step <= 1 || !isCartSent) {\n        fbq('InitiateCheckout', purchaseData)\n        fbq('Checkout', customData, true)\n        isCartSent = true\n      } else if (!isCheckoutSent) {\n        fbq('CheckoutOption', customData, true)\n        isCheckoutSent = true\n      }\n    }\n\n    const emitPurchase = orderId => {\n      if (!isPurchaseSent && options.disablePurchase !== true) {\n        fbq('Purchase', {\n          ...getPurchaseData(),\n          order_id: orderId\n        })\n        isPurchaseSent = true\n      }\n    }\n\n    const addRouteToData = ({ name, params }) => {\n      switch (name) {\n        case 'cart':\n          emitCheckout(1, 'Review Cart')\n          break\n        case 'checkout':\n          emitCheckout(2, 'Confirm Purchase')\n          break\n        case 'confirmation':\n          emitPurchase(params.id)\n          break\n      }\n    }\n\n    if (router.currentRoute) {\n      addRouteToData(router.currentRoute)\n    }\n    router.afterEach(addRouteToData)\n  }\n}\n","import ecomCart from '@ecomplus/shopping-cart'\nimport { getProductData } from './common'\n\nexport default fbq => {\n  ecomCart.on('addItem', ({ item }) => {\n    fbq('AddToCart', getProductData(item))\n  })\n}\n"],"sourceRoot":""}